<!DOCTYPE html>
<html>
<head>
    <meta http-eqiv='content-type' content='text/html;charset=utf-8'>
    <title>tempest</title>
    <link rel=stylesheet href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id=container>
    <div id=background></div>
    <table cellspacing=0 cellpadding=0>
    <thead>
      <tr>
        <th class=docs><h1>tempest</h1></th>
        <th class=code></th>
      </tr>
    </thead>
    <tbody>
        <tr><td class='docs'><?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<p>lib/tempest
Install and configure Tempest
Dependencies:</p>
<ul class="simple">
<li><tt class="docutils literal">functions</tt> file</li>
<li><tt class="docutils literal">lib/nova</tt> service is running</li>
<li>Global vars that are assumed to be defined:
- <tt class="docutils literal">DEST</tt>, <tt class="docutils literal">FILES</tt>
- <tt class="docutils literal">ADMIN_PASSWORD</tt>
- <tt class="docutils literal">DEFAULT_IMAGE_NAME</tt>
- <tt class="docutils literal">S3_SERVICE_PORT</tt>
- <tt class="docutils literal">SERVICE_HOST</tt>
- <tt class="docutils literal">BASE_SQL_CONN</tt> <tt class="docutils literal">lib/database</tt> declares
- <tt class="docutils literal">PUBLIC_NETWORK_NAME</tt>
- <tt class="docutils literal">Q_USE_NAMESPACE</tt>
- <tt class="docutils literal">Q_ROUTER_NAME</tt>
- <tt class="docutils literal">Q_L3_ENABLED</tt>
- <tt class="docutils literal">VIRT_DRIVER</tt>
- <tt class="docutils literal">LIBVIRT_TYPE</tt>
- <tt class="docutils literal">KEYSTONE_SERVICE_PROTOCOL</tt>, <tt class="docutils literal">KEYSTONE_SERVICE_HOST</tt> from lib/keystone</li>
</ul>
<p>Optional Dependencies:</p>
<ul class="simple">
<li><tt class="docutils literal">ALT_*</tt> (similar vars exists in keystone_data.sh)</li>
<li><tt class="docutils literal">LIVE_MIGRATION_AVAILABLE</tt></li>
<li><tt class="docutils literal">USE_BLOCK_MIGRATION_FOR_LIVE_MIGRATION</tt></li>
<li><tt class="docutils literal">DEFAULT_INSTANCE_TYPE</tt></li>
<li><tt class="docutils literal">DEFAULT_INSTANCE_USER</tt></li>
<li><tt class="docutils literal">CINDER_MULTI_LVM_BACKEND</tt></li>
</ul>
<p><tt class="docutils literal">stack.sh</tt> calls the entry points in this order:</p>
<ul class="simple">
<li>install_tempest</li>
<li>configure_tempest</li>
<li>init_tempest</li>
</ul>
</td><td class=code><div class=highlight><pre>


</pre></div></td></tr><tr><td class=docs>
<p>Save trace setting</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">XTRACE</span><span class="o">=</span><span class="k">$(</span><span class="nb">set</span> +o | grep xtrace<span class="k">)</span>
<span class="nb">set</span> +o xtrace


</pre></div></td></tr><tr><td class=docs>
<div class="section" id="defaults">
<h1>Defaults</h1>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
<p>Set up default directories</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">TEMPEST_DIR</span><span class="o">=</span><span class="nv">$DEST</span>/tempest
<span class="nv">TEMPEST_CONFIG_DIR</span><span class="o">=</span><span class="k">${</span><span class="nv">TEMPEST_CONFIG_DIR</span><span class="k">:-</span><span class="nv">$TEMPEST_DIR</span><span class="p">/etc</span><span class="k">}</span>
<span class="nv">TEMPEST_CONFIG</span><span class="o">=</span><span class="nv">$TEMPEST_CONFIG_DIR</span>/tempest.conf
<span class="nv">TEMPEST_STATE_PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">TEMPEST_STATE_PATH</span><span class="p">:=</span><span class="nv">$DATA_DIR</span><span class="p">/tempest</span><span class="k">}</span>
<span class="nv">TEMPEST_LIB_DIR</span><span class="o">=</span><span class="nv">$DEST</span>/tempest-lib

<span class="nv">NOVA_SOURCE_DIR</span><span class="o">=</span><span class="nv">$DEST</span>/nova

<span class="nv">BUILD_INTERVAL</span><span class="o">=</span>1

</pre></div></td></tr><tr><td class=docs>
<p>This is the timeout that tempest will wait for a VM to change state,
spawn, delete, etc.
The default is set to 196 seconds.</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">BUILD_TIMEOUT</span><span class="o">=</span><span class="k">${</span><span class="nv">BUILD_TIMEOUT</span><span class="k">:-</span><span class="nv">196</span><span class="k">}</span>


<span class="nv">BOTO_MATERIALS_PATH</span><span class="o">=</span><span class="s2">&quot;$FILES/images/s3-materials/cirros-${CIRROS_VERSION}&quot;</span>

</pre></div></td></tr><tr><td class=docs>
<p>Cinder/Volume variables</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">TEMPEST_VOLUME_DRIVER</span><span class="o">=</span><span class="k">${</span><span class="nv">TEMPEST_VOLUME_DRIVER</span><span class="k">:-</span><span class="nv">default</span><span class="k">}</span>
<span class="nv">TEMPEST_VOLUME_VENDOR</span><span class="o">=</span><span class="k">${</span><span class="nv">TEMPEST_VOLUME_VENDOR</span><span class="k">:-</span><span class="s2">&quot;Open Source&quot;</span><span class="k">}</span>
<span class="nv">TEMPEST_STORAGE_PROTOCOL</span><span class="o">=</span><span class="k">${</span><span class="nv">TEMPEST_STORAGE_PROTOCOL</span><span class="k">:-</span><span class="nv">iSCSI</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>Neutron/Network variables</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">IPV6_ENABLED</span><span class="o">=</span><span class="k">$(</span>trueorfalse True <span class="nv">$IPV6_ENABLED</span><span class="k">)</span>
<span class="nv">IPV6_SUBNET_ATTRIBUTES_ENABLED</span><span class="o">=</span><span class="k">$(</span>trueorfalse True <span class="nv">$IPV6_SUBNET_ATTRIBUTES_ENABLED</span><span class="k">)</span>

</pre></div></td></tr><tr><td class=docs>
</div>
<div class="section" id="functions">
<h1>Functions</h1>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
<p>configure_tempest() - Set config files, create data dirs, etc</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>configure_tempest <span class="o">{</span>
    setup_develop <span class="nv">$TEMPEST_DIR</span>
    <span class="nb">local </span>image_lines
    <span class="nb">local </span>images
    <span class="nb">local </span>num_images
    <span class="nb">local </span>image_uuid
    <span class="nb">local </span>image_uuid_alt
    <span class="nb">local </span>password
    <span class="nb">local </span>line
    <span class="nb">local </span>flavors
    <span class="nb">local </span>available_flavors
    <span class="nb">local </span>flavors_ref
    <span class="nb">local </span>flavor_lines
    <span class="nb">local </span>public_network_id
    <span class="nb">local </span>public_router_id
    <span class="nb">local </span>tenant_networks_reachable
    <span class="nb">local </span><span class="nv">boto_instance_type</span><span class="o">=</span><span class="s2">&quot;m1.tiny&quot;</span>
    <span class="nb">local </span><span class="nv">ssh_connect_method</span><span class="o">=</span><span class="s2">&quot;fixed&quot;</span>

</pre></div></td></tr><tr><td class=docs>
<p>Save IFS</p>
</td><td class=code><div class=highlight><pre>
    <span class="nv">ifs</span><span class="o">=</span><span class="nv">$IFS</span>

</pre></div></td></tr><tr><td class=docs>
<p>Glance should already contain images to be used in tempest
testing. Here we simply look for images stored in Glance
and set the appropriate variables for use in the tempest config
We ignore ramdisk and kernel images, look for the default image
<tt class="docutils literal">DEFAULT_IMAGE_NAME</tt>. If not found, we set the <tt class="docutils literal">image_uuid</tt> to the
first image returned and set <tt class="docutils literal">image_uuid_alt</tt> to the second,
if there is more than one returned...
... Also ensure we only take active images, so we don't get snapshots in process</p>
</td><td class=code><div class=highlight><pre>
    <span class="nb">declare</span> -a images

    <span class="k">while </span><span class="nb">read</span> -r IMAGE_NAME IMAGE_UUID; <span class="k">do</span>
<span class="k">        if</span> <span class="o">[</span> <span class="s2">&quot;$IMAGE_NAME&quot;</span> <span class="o">=</span> <span class="s2">&quot;$DEFAULT_IMAGE_NAME&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">            </span><span class="nv">image_uuid</span><span class="o">=</span><span class="s2">&quot;$IMAGE_UUID&quot;</span>
            <span class="nv">image_uuid_alt</span><span class="o">=</span><span class="s2">&quot;$IMAGE_UUID&quot;</span>
        <span class="k">fi</span>
<span class="k">        </span>images+<span class="o">=(</span><span class="nv">$IMAGE_UUID</span><span class="o">)</span>
</pre></div></td></tr><tr><td class=docs>
<p>TODO(stevemar): update this command to use openstackclient's <cite>openstack image list</cite>
when it supports listing by status.</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">done</span> &lt; &lt;<span class="o">(</span>glance image-list --status<span class="o">=</span>active | awk -F<span class="s1">&#39;|&#39;</span> <span class="s1">&#39;!/^(+--)|ID|aki|ari/ { print $3,$2 }&#39;</span><span class="o">)</span>

    <span class="k">case</span> <span class="s2">&quot;${#images[*]}&quot;</span> in
        0<span class="o">)</span>
            <span class="nb">echo</span> <span class="s2">&quot;Found no valid images to use!&quot;</span>
            <span class="nb">exit </span>1
            ;;
        1<span class="o">)</span>
            <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$image_uuid&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">                </span><span class="nv">image_uuid</span><span class="o">=</span><span class="k">${</span><span class="nv">images</span><span class="p">[0]</span><span class="k">}</span>
                <span class="nv">image_uuid_alt</span><span class="o">=</span><span class="k">${</span><span class="nv">images</span><span class="p">[0]</span><span class="k">}</span>
            <span class="k">fi</span>
            ;;
        *<span class="o">)</span>
            <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$image_uuid&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">                </span><span class="nv">image_uuid</span><span class="o">=</span><span class="k">${</span><span class="nv">images</span><span class="p">[0]</span><span class="k">}</span>
                <span class="nv">image_uuid_alt</span><span class="o">=</span><span class="k">${</span><span class="nv">images</span><span class="p">[1]</span><span class="k">}</span>
            <span class="k">fi</span>
            ;;
    <span class="k">esac</span>

</pre></div></td></tr><tr><td class=docs>
<p>Create tempest.conf from tempest.conf.sample
copy every time, because the image UUIDS are going to change</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">if</span> <span class="o">[[</span> ! -d <span class="nv">$TEMPEST_CONFIG_DIR</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">        </span>sudo mkdir -p <span class="nv">$TEMPEST_CONFIG_DIR</span>
    <span class="k">fi</span>
<span class="k">    </span>sudo chown <span class="nv">$STACK_USER</span> <span class="nv">$TEMPEST_CONFIG_DIR</span>
    cp <span class="nv">$TEMPEST_DIR</span>/etc/tempest.conf.sample <span class="nv">$TEMPEST_CONFIG</span>
    chmod 644 <span class="nv">$TEMPEST_CONFIG</span>

    <span class="nv">password</span><span class="o">=</span><span class="k">${</span><span class="nv">ADMIN_PASSWORD</span><span class="k">:-</span><span class="nv">secrete</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>See files/keystone_data.sh and stack.sh where admin, demo and alt_demo
user and tenant are set up...</p>
</td><td class=code><div class=highlight><pre>
    <span class="nv">ADMIN_USERNAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ADMIN_USERNAME</span><span class="k">:-</span><span class="nv">admin</span><span class="k">}</span>
    <span class="nv">ADMIN_TENANT_NAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ADMIN_TENANT_NAME</span><span class="k">:-</span><span class="nv">admin</span><span class="k">}</span>
    <span class="nv">ADMIN_DOMAIN_NAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ADMIN_DOMAIN_NAME</span><span class="k">:-</span><span class="nv">Default</span><span class="k">}</span>
    <span class="nv">TEMPEST_USERNAME</span><span class="o">=</span><span class="k">${</span><span class="nv">TEMPEST_USERNAME</span><span class="k">:-</span><span class="nv">demo</span><span class="k">}</span>
    <span class="nv">TEMPEST_TENANT_NAME</span><span class="o">=</span><span class="k">${</span><span class="nv">TEMPEST_TENANT_NAME</span><span class="k">:-</span><span class="nv">demo</span><span class="k">}</span>
    <span class="nv">ALT_USERNAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ALT_USERNAME</span><span class="k">:-</span><span class="nv">alt_demo</span><span class="k">}</span>
    <span class="nv">ALT_TENANT_NAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ALT_TENANT_NAME</span><span class="k">:-</span><span class="nv">alt_demo</span><span class="k">}</span>
    <span class="nv">ADMIN_TENANT_ID</span><span class="o">=</span><span class="k">$(</span>openstack project list | awk <span class="s2">&quot;/ admin / { print \$2 }&quot;</span><span class="k">)</span>

</pre></div></td></tr><tr><td class=docs>
<p>If the <tt class="docutils literal">DEFAULT_INSTANCE_TYPE</tt> not declared, use the new behavior
Tempest creates instane types for himself</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">if</span>  <span class="o">[[</span> -z <span class="s2">&quot;$DEFAULT_INSTANCE_TYPE&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">available_flavors</span><span class="o">=</span><span class="k">$(</span>nova flavor-list<span class="k">)</span>
        <span class="k">if</span> <span class="o">[[</span> ! <span class="o">(</span> <span class="nv">$available_flavors</span> <span class="o">=</span>~ <span class="s1">&#39;m1.nano&#39;</span> <span class="o">)</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">            if </span>is_arch <span class="s2">&quot;ppc64&quot;</span>; <span class="k">then</span>
</pre></div></td></tr><tr><td class=docs>
<p>qemu needs at least 128MB of memory to boot on ppc64</p>
</td><td class=code><div class=highlight><pre>
                nova flavor-create m1.nano 42 128 0 1
            <span class="k">else</span>
<span class="k">                </span>nova flavor-create m1.nano 42 64 0 1
            <span class="k">fi</span>
<span class="k">        fi</span>
<span class="k">        </span><span class="nv">flavor_ref</span><span class="o">=</span>42
        <span class="nv">boto_instance_type</span><span class="o">=</span>m1.nano
        <span class="k">if</span> <span class="o">[[</span> ! <span class="o">(</span> <span class="nv">$available_flavors</span> <span class="o">=</span>~ <span class="s1">&#39;m1.micro&#39;</span> <span class="o">)</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">            if </span>is_arch <span class="s2">&quot;ppc64&quot;</span>; <span class="k">then</span>
<span class="k">                </span>nova flavor-create m1.micro 84 256 0 1
            <span class="k">else</span>
<span class="k">                </span>nova flavor-create m1.micro 84 128 0 1
            <span class="k">fi</span>
<span class="k">        fi</span>
<span class="k">        </span><span class="nv">flavor_ref_alt</span><span class="o">=</span>84
    <span class="k">else</span>
</pre></div></td></tr><tr><td class=docs>
<p>Check Nova for existing flavors and, if set, look for the
<tt class="docutils literal">DEFAULT_INSTANCE_TYPE</tt> and use that.</p>
</td><td class=code><div class=highlight><pre>
        <span class="nv">boto_instance_type</span><span class="o">=</span><span class="nv">$DEFAULT_INSTANCE_TYPE</span>
        <span class="nv">flavor_lines</span><span class="o">=</span><span class="sb">`</span>nova flavor-list<span class="sb">`</span>
        <span class="nv">IFS</span><span class="o">=</span><span class="s1">$&#39;\r\n&#39;</span>
        <span class="nv">flavors</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="k">for </span>line in <span class="nv">$flavor_lines</span>; <span class="k">do</span>
<span class="k">            </span><span class="nv">f</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$line</span> | awk <span class="s2">&quot;/ $DEFAULT_INSTANCE_TYPE / { print \$2 }&quot;</span><span class="k">)</span>
            <span class="nv">flavors</span><span class="o">=</span><span class="s2">&quot;$flavors $f&quot;</span>
        <span class="k">done</span>

<span class="k">        for </span>line in <span class="nv">$flavor_lines</span>; <span class="k">do</span>
<span class="k">            </span><span class="nv">flavors</span><span class="o">=</span><span class="s2">&quot;$flavors `echo $line | grep -v &quot;</span>^<span class="se">\(</span>|<span class="se">\s</span>*ID<span class="se">\|</span>+--<span class="se">\)</span><span class="s2">&quot; | cut -d&#39; &#39; -f2`&quot;</span>
        <span class="k">done</span>

<span class="k">        </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot; &quot;</span>
        <span class="nv">flavors</span><span class="o">=(</span><span class="nv">$flavors</span><span class="o">)</span>
        <span class="nv">num_flavors</span><span class="o">=</span><span class="k">${#</span><span class="nv">flavors</span><span class="p">[*]</span><span class="k">}</span>
        <span class="nb">echo</span> <span class="s2">&quot;Found $num_flavors flavors&quot;</span>
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$num_flavors</span> -eq 0 <span class="o">]]</span>; <span class="k">then</span>
<span class="k">            </span><span class="nb">echo</span> <span class="s2">&quot;Found no valid flavors to use!&quot;</span>
            <span class="nb">exit </span>1
        <span class="k">fi</span>
<span class="k">        </span><span class="nv">flavor_ref</span><span class="o">=</span><span class="k">${</span><span class="nv">flavors</span><span class="p">[0]</span><span class="k">}</span>
        <span class="nv">flavor_ref_alt</span><span class="o">=</span><span class="nv">$flavor_ref</span>

</pre></div></td></tr><tr><td class=docs>
<p>ensure flavor_ref and flavor_ref_alt have different values
some resize instance in tempest tests depends on this.</p>
</td><td class=code><div class=highlight><pre>
        <span class="k">for </span>f in <span class="k">${</span><span class="nv">flavors</span><span class="p">[@]:</span><span class="nv">1</span><span class="k">}</span>; <span class="k">do</span>
<span class="k">            if</span> <span class="o">[[</span> <span class="nv">$f</span> -ne <span class="nv">$flavor_ref</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">                </span><span class="nv">flavor_ref_alt</span><span class="o">=</span><span class="nv">$f</span>
                <span class="nb">break</span>
<span class="nb">            </span><span class="k">fi</span>
<span class="k">        done</span>
<span class="k">    fi</span>

<span class="k">    if</span> <span class="o">[</span> <span class="s2">&quot;$Q_USE_NAMESPACE&quot;</span> !<span class="o">=</span> <span class="s2">&quot;False&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">tenant_networks_reachable</span><span class="o">=</span><span class="nb">false</span>
<span class="nb">        </span><span class="k">if</span> ! is_service_enabled n-net; <span class="k">then</span>
<span class="k">            </span><span class="nv">ssh_connect_method</span><span class="o">=</span><span class="s2">&quot;floating&quot;</span>
        <span class="k">fi</span>
<span class="k">    else</span>
<span class="k">        </span><span class="nv">tenant_networks_reachable</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">    </span><span class="k">fi</span>

<span class="k">    </span><span class="nv">ssh_connect_method</span><span class="o">=</span><span class="k">${</span><span class="nv">TEMPEST_SSH_CONNECT_METHOD</span><span class="k">:-</span><span class="nv">$ssh_connect_method</span><span class="k">}</span>

    <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$Q_L3_ENABLED&quot;</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">public_network_id</span><span class="o">=</span><span class="k">$(</span>neutron net-list | grep <span class="nv">$PUBLIC_NETWORK_NAME</span> | <span class="se">\</span>
            awk <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$Q_USE_NAMESPACE&quot;</span> <span class="o">==</span> <span class="s2">&quot;False&quot;</span> <span class="o">]</span>; <span class="k">then</span>
</pre></div></td></tr><tr><td class=docs>
<p>If namespaces are disabled, devstack will create a single
public router that tempest should be configured to use.</p>
</td><td class=code><div class=highlight><pre>
            <span class="nv">public_router_id</span><span class="o">=</span><span class="k">$(</span>neutron router-list | awk <span class="s2">&quot;/ $Q_ROUTER_NAME / \</span>
<span class="s2">                { print \$2 }&quot;</span><span class="k">)</span>
        <span class="k">fi</span>
<span class="k">    fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Oslo</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> DEFAULT lock_path <span class="nv">$TEMPEST_STATE_PATH</span>
    mkdir -p <span class="nv">$TEMPEST_STATE_PATH</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> DEFAULT use_stderr False
    iniset <span class="nv">$TEMPEST_CONFIG</span> DEFAULT log_file tempest.log
    iniset <span class="nv">$TEMPEST_CONFIG</span> DEFAULT debug True

</pre></div></td></tr><tr><td class=docs>
<p>Timeouts</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute build_timeout <span class="nv">$BUILD_TIMEOUT</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> volume build_timeout <span class="nv">$BUILD_TIMEOUT</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> boto build_timeout <span class="nv">$BUILD_TIMEOUT</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> boto http_socket_timeout 5

</pre></div></td></tr><tr><td class=docs>
<p>Identity</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity uri <span class="s2">&quot;$KEYSTONE_SERVICE_PROTOCOL://$KEYSTONE_SERVICE_HOST:5000/v2.0/&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity uri_v3 <span class="s2">&quot;$KEYSTONE_SERVICE_PROTOCOL://$KEYSTONE_SERVICE_HOST:5000/v3/&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity username <span class="nv">$TEMPEST_USERNAME</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity password <span class="s2">&quot;$password&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity tenant_name <span class="nv">$TEMPEST_TENANT_NAME</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity alt_username <span class="nv">$ALT_USERNAME</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity alt_password <span class="s2">&quot;$password&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity alt_tenant_name <span class="nv">$ALT_TENANT_NAME</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity admin_username <span class="nv">$ADMIN_USERNAME</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity admin_password <span class="s2">&quot;$password&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity admin_tenant_name <span class="nv">$ADMIN_TENANT_NAME</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity admin_tenant_id <span class="nv">$ADMIN_TENANT_ID</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity admin_domain_name <span class="nv">$ADMIN_DOMAIN_NAME</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> identity auth_version <span class="k">${</span><span class="nv">TEMPEST_AUTH_VERSION</span><span class="k">:-</span><span class="nv">v2</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>Image
for the gate we want to be able to override this variable so we aren't
doing an HTTP fetch over the wide internet for this test</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">if</span> <span class="o">[[</span> ! -z <span class="s2">&quot;$TEMPEST_HTTP_IMAGE&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">        </span>iniset <span class="nv">$TEMPEST_CONFIG</span> image http_image <span class="nv">$TEMPEST_HTTP_IMAGE</span>
    <span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Compute</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute allow_tenant_isolation <span class="k">${</span><span class="nv">TEMPEST_ALLOW_TENANT_ISOLATION</span><span class="k">:-</span><span class="nv">True</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute ssh_user <span class="k">${</span><span class="nv">DEFAULT_INSTANCE_USER</span><span class="k">:-</span><span class="nv">cirros</span><span class="k">}</span> <span class="c"># DEPRECATED</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute network_for_ssh <span class="nv">$PRIVATE_NETWORK_NAME</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute ip_version_for_ssh 4
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute ssh_timeout <span class="nv">$BUILD_TIMEOUT</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute image_ref <span class="nv">$image_uuid</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute image_ssh_user <span class="k">${</span><span class="nv">DEFAULT_INSTANCE_USER</span><span class="k">:-</span><span class="nv">cirros</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute image_ref_alt <span class="nv">$image_uuid_alt</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute image_alt_ssh_user <span class="k">${</span><span class="nv">DEFAULT_INSTANCE_USER</span><span class="k">:-</span><span class="nv">cirros</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute flavor_ref <span class="nv">$flavor_ref</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute flavor_ref_alt <span class="nv">$flavor_ref_alt</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute ssh_connect_method <span class="nv">$ssh_connect_method</span>

</pre></div></td></tr><tr><td class=docs>
<p>Compute Features</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled resize True
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled live_migration <span class="k">${</span><span class="nv">LIVE_MIGRATION_AVAILABLE</span><span class="k">:-</span><span class="nv">False</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled change_password False
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled block_migration_for_live_migration <span class="k">${</span><span class="nv">USE_BLOCK_MIGRATION_FOR_LIVE_MIGRATION</span><span class="k">:-</span><span class="nv">False</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled api_extensions <span class="k">${</span><span class="nv">COMPUTE_API_EXTENSIONS</span><span class="k">:-</span><span class="s2">&quot;all&quot;</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-disabled api_extensions <span class="k">${</span><span class="nv">DISABLE_COMPUTE_API_EXTENSIONS</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>Compute admin</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> <span class="s2">&quot;compute-admin&quot;</span> username <span class="nv">$ADMIN_USERNAME</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> <span class="s2">&quot;compute-admin&quot;</span> password <span class="s2">&quot;$password&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> <span class="s2">&quot;compute-admin&quot;</span> tenant_name <span class="nv">$ADMIN_TENANT_NAME</span>

    <span class="c"># Network</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> network api_version 2.0
    iniset <span class="nv">$TEMPEST_CONFIG</span> network tenant_networks_reachable <span class="s2">&quot;$tenant_networks_reachable&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> network public_network_id <span class="s2">&quot;$public_network_id&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> network public_router_id <span class="s2">&quot;$public_router_id&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> network default_network <span class="s2">&quot;$FIXED_RANGE&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> network-feature-enabled ipv6 <span class="s2">&quot;$IPV6_ENABLED&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> network-feature-enabled ipv6_subnet_attributes <span class="s2">&quot;$IPV6_SUBNET_ATTRIBUTES_ENABLED&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> network-feature-enabled api_extensions <span class="k">${</span><span class="nv">NETWORK_API_EXTENSIONS</span><span class="k">:-</span><span class="s2">&quot;all&quot;</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> network-feature-disabled api_extensions <span class="k">${</span><span class="nv">DISABLE_NETWORK_API_EXTENSIONS</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>boto</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> boto ec2_url <span class="s2">&quot;$EC2_SERVICE_PROTOCOL://$SERVICE_HOST:8773/services/Cloud&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> boto s3_url <span class="s2">&quot;http://$SERVICE_HOST:${S3_SERVICE_PORT:-3333}&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> boto s3_materials_path <span class="s2">&quot;$BOTO_MATERIALS_PATH&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> boto ari_manifest cirros-<span class="k">${</span><span class="nv">CIRROS_VERSION</span><span class="k">}</span>-<span class="k">${</span><span class="nv">CIRROS_ARCH</span><span class="k">}</span>-initrd.manifest.xml
    iniset <span class="nv">$TEMPEST_CONFIG</span> boto ami_manifest cirros-<span class="k">${</span><span class="nv">CIRROS_VERSION</span><span class="k">}</span>-<span class="k">${</span><span class="nv">CIRROS_ARCH</span><span class="k">}</span>-blank.img.manifest.xml
    iniset <span class="nv">$TEMPEST_CONFIG</span> boto aki_manifest cirros-<span class="k">${</span><span class="nv">CIRROS_VERSION</span><span class="k">}</span>-<span class="k">${</span><span class="nv">CIRROS_ARCH</span><span class="k">}</span>-vmlinuz.manifest.xml
    iniset <span class="nv">$TEMPEST_CONFIG</span> boto instance_type <span class="s2">&quot;$boto_instance_type&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> boto http_socket_timeout 30
    iniset <span class="nv">$TEMPEST_CONFIG</span> boto ssh_user <span class="k">${</span><span class="nv">DEFAULT_INSTANCE_USER</span><span class="k">:-</span><span class="nv">cirros</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>Orchestration Tests</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">if </span>is_service_enabled heat; <span class="k">then</span>
<span class="k">        if</span> <span class="o">[[</span> ! -z <span class="s2">&quot;$HEAT_CFN_IMAGE_URL&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">            </span>iniset <span class="nv">$TEMPEST_CONFIG</span> orchestration image_ref <span class="k">$(</span>basename <span class="s2">&quot;$HEAT_CFN_IMAGE_URL&quot;</span> <span class="s2">&quot;.qcow2&quot;</span><span class="k">)</span>
        <span class="k">fi</span>
</pre></div></td></tr><tr><td class=docs>
<p>build a specialized heat flavor</p>
</td><td class=code><div class=highlight><pre>
        <span class="nv">available_flavors</span><span class="o">=</span><span class="k">$(</span>nova flavor-list<span class="k">)</span>
        <span class="k">if</span> <span class="o">[[</span> ! <span class="o">(</span> <span class="nv">$available_flavors</span> <span class="o">=</span>~ <span class="s1">&#39;m1.heat&#39;</span> <span class="o">)</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">            </span>nova flavor-create m1.heat 451 512 0 1
        <span class="k">fi</span>
<span class="k">        </span>iniset <span class="nv">$TEMPEST_CONFIG</span> orchestration instance_type <span class="s2">&quot;m1.heat&quot;</span>
        iniset <span class="nv">$TEMPEST_CONFIG</span> orchestration build_timeout 900
    <span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Scenario</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> scenario img_dir <span class="s2">&quot;$FILES/images/cirros-${CIRROS_VERSION}-${CIRROS_ARCH}-uec&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> scenario ami_img_file <span class="s2">&quot;cirros-${CIRROS_VERSION}-${CIRROS_ARCH}-blank.img&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> scenario ari_img_file <span class="s2">&quot;cirros-${CIRROS_VERSION}-${CIRROS_ARCH}-initrd&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> scenario aki_img_file <span class="s2">&quot;cirros-${CIRROS_VERSION}-${CIRROS_ARCH}-vmlinuz&quot;</span>

</pre></div></td></tr><tr><td class=docs>
<p>Large Ops Number</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> scenario large_ops_number <span class="k">${</span><span class="nv">TEMPEST_LARGE_OPS_NUMBER</span><span class="k">:-</span><span class="nv">0</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>Telemetry
Ceilometer API optimization happened in juno that allows to run more tests in tempest.
Once Tempest retires support for icehouse this flag can be removed.</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> telemetry too_slow_to_test <span class="s2">&quot;False&quot;</span>

</pre></div></td></tr><tr><td class=docs>
<p>Object storage</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> object-storage-feature-enabled discoverable_apis <span class="k">${</span><span class="nv">OBJECT_STORAGE_API_EXTENSIONS</span><span class="k">:-</span><span class="s2">&quot;all&quot;</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> object-storage-feature-disabled discoverable_apis <span class="k">${</span><span class="nv">OBJECT_STORAGE_DISABLE_API_EXTENSIONS</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>Volume</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> volume-feature-enabled api_extensions <span class="k">${</span><span class="nv">VOLUME_API_EXTENSIONS</span><span class="k">:-</span><span class="s2">&quot;all&quot;</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> volume-feature-disabled api_extensions <span class="k">${</span><span class="nv">DISABLE_VOLUME_API_EXTENSIONS</span><span class="k">}</span>
    <span class="k">if</span> ! is_service_enabled c-bak; <span class="k">then</span>
<span class="k">        </span>iniset <span class="nv">$TEMPEST_CONFIG</span> volume-feature-enabled backup False
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">CINDER_MULTI_LVM_BACKEND</span><span class="o">=</span><span class="k">$(</span>trueorfalse False <span class="nv">$CINDER_MULTI_LVM_BACKEND</span><span class="k">)</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$CINDER_MULTI_LVM_BACKEND</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>iniset <span class="nv">$TEMPEST_CONFIG</span> volume-feature-enabled multi_backend <span class="s2">&quot;True&quot;</span>
        iniset <span class="nv">$TEMPEST_CONFIG</span> volume backend1_name <span class="s2">&quot;LVM_iSCSI&quot;</span>
        iniset <span class="nv">$TEMPEST_CONFIG</span> volume backend2_name <span class="s2">&quot;LVM_iSCSI_2&quot;</span>
    <span class="k">fi</span>

<span class="k">    if</span> <span class="o">[</span> <span class="nv">$TEMPEST_VOLUME_DRIVER</span> !<span class="o">=</span> <span class="s2">&quot;default&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>iniset <span class="nv">$TEMPEST_CONFIG</span> volume vendor_name <span class="s2">&quot;$TEMPEST_VOLUME_VENDOR&quot;</span>
        iniset <span class="nv">$TEMPEST_CONFIG</span> volume storage_protocol <span class="nv">$TEMPEST_STORAGE_PROTOCOL</span>
    <span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Dashboard</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> dashboard dashboard_url <span class="s2">&quot;http://$SERVICE_HOST/&quot;</span>
    iniset <span class="nv">$TEMPEST_CONFIG</span> dashboard login_url <span class="s2">&quot;http://$SERVICE_HOST/auth/login/&quot;</span>

</pre></div></td></tr><tr><td class=docs>
<p>cli</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONFIG</span> cli cli_dir <span class="nv">$NOVA_BIN_DIR</span>

</pre></div></td></tr><tr><td class=docs>
<p>Baremetal</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$VIRT_DRIVER&quot;</span> <span class="o">=</span> <span class="s2">&quot;ironic&quot;</span> <span class="o">]</span> ; <span class="k">then</span>
<span class="k">        </span>iniset <span class="nv">$TEMPEST_CONFIG</span> baremetal driver_enabled True
        iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled change_password False
        iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled console_output False
        iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled interface_attach False
        iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled live_migration False
        iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled pause False
        iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled rescue False
        iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled resize False
        iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled shelve False
        iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled snapshot False
        iniset <span class="nv">$TEMPEST_CONFIG</span> compute-feature-enabled <span class="nb">suspend </span>False
    <span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>service_available</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">for </span>service in <span class="k">${</span><span class="nv">TEMPEST_SERVICES</span><span class="p">//,/ </span><span class="k">}</span>; <span class="k">do</span>
<span class="k">        if </span>is_service_enabled <span class="nv">$service</span> ; <span class="k">then</span>
<span class="k">            </span>iniset <span class="nv">$TEMPEST_CONFIG</span> service_available <span class="nv">$service</span> <span class="s2">&quot;True&quot;</span>
        <span class="k">else</span>
<span class="k">            </span>iniset <span class="nv">$TEMPEST_CONFIG</span> service_available <span class="nv">$service</span> <span class="s2">&quot;False&quot;</span>
        <span class="k">fi</span>
<span class="k">    done</span>

</pre></div></td></tr><tr><td class=docs>
<p>Restore IFS</p>
</td><td class=code><div class=highlight><pre>
    <span class="nv">IFS</span><span class="o">=</span><span class="nv">$ifs</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>create_tempest_accounts() - Set up common required tempest accounts</p>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
</div>
<div class="section" id="project-user-roles">
<h1>Project              User         Roles</h1>
<p>alt_demo             alt_demo     Member</p>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
<p>Migrated from keystone_data.sh</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>create_tempest_accounts <span class="o">{</span>
    <span class="k">if </span>is_service_enabled tempest; <span class="k">then</span>
</pre></div></td></tr><tr><td class=docs>
<p>Tempest has some tests that validate various authorization checks
between two regular users in separate tenants</p>
</td><td class=code><div class=highlight><pre>
        get_or_create_project alt_demo
        get_or_create_user alt_demo <span class="s2">&quot;$ADMIN_PASSWORD&quot;</span> alt_demo <span class="s2">&quot;alt_demo@example.com&quot;</span>
        get_or_add_user_role Member alt_demo alt_demo
    <span class="k">fi</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>install_tempest_lib() - Collect source, prepare, and install tempest-lib</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>install_tempest_lib <span class="o">{</span>
    git_clone <span class="nv">$TEMPEST_LIB_REPO</span> <span class="nv">$TEMPEST_LIB_DIR</span> <span class="nv">$TEMPEST_LIB_BRANCH</span>
    setup_develop <span class="nv">$TEMPEST_LIB_DIR</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>install_tempest() - Collect source and prepare</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>install_tempest <span class="o">{</span>
    install_tempest_lib
    git_clone <span class="nv">$TEMPEST_REPO</span> <span class="nv">$TEMPEST_DIR</span> <span class="nv">$TEMPEST_BRANCH</span>
    pip_install tox
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>init_tempest() - Initialize ec2 images</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>init_tempest <span class="o">{</span>
    <span class="nb">local </span><span class="nv">base_image_name</span><span class="o">=</span>cirros-<span class="k">${</span><span class="nv">CIRROS_VERSION</span><span class="k">}</span>-<span class="k">${</span><span class="nv">CIRROS_ARCH</span><span class="k">}</span>
</pre></div></td></tr><tr><td class=docs>
<p>/opt/stack/devstack/files/images/cirros-${CIRROS_VERSION}-${CIRROS_ARCH}-uec</p>
</td><td class=code><div class=highlight><pre>
    <span class="nb">local </span><span class="nv">image_dir</span><span class="o">=</span><span class="s2">&quot;$FILES/images/${base_image_name}-uec&quot;</span>
    <span class="nb">local </span><span class="nv">kernel</span><span class="o">=</span><span class="s2">&quot;$image_dir/${base_image_name}-vmlinuz&quot;</span>
    <span class="nb">local </span><span class="nv">ramdisk</span><span class="o">=</span><span class="s2">&quot;$image_dir/${base_image_name}-initrd&quot;</span>
    <span class="nb">local </span><span class="nv">disk_image</span><span class="o">=</span><span class="s2">&quot;$image_dir/${base_image_name}-blank.img&quot;</span>
</pre></div></td></tr><tr><td class=docs>
<p>if the cirros uec downloaded and the system is uec capable</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&quot;$kernel&quot;</span> -a -f <span class="s2">&quot;$ramdisk&quot;</span> -a -f <span class="s2">&quot;$disk_image&quot;</span> -a  <span class="s2">&quot;$VIRT_DRIVER&quot;</span> !<span class="o">=</span> <span class="s2">&quot;openvz&quot;</span> <span class="se">\</span>
        -a <span class="se">\(</span> <span class="s2">&quot;$LIBVIRT_TYPE&quot;</span> !<span class="o">=</span> <span class="s2">&quot;lxc&quot;</span> -o <span class="s2">&quot;$VIRT_DRIVER&quot;</span> !<span class="o">=</span> <span class="s2">&quot;libvirt&quot;</span> <span class="se">\)</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nb">echo</span> <span class="s2">&quot;Prepare aki/ari/ami Images&quot;</span>
        mkdir -p <span class="nv">$BOTO_MATERIALS_PATH</span>
        <span class="o">(</span> <span class="c">#new namespace</span>
</pre></div></td></tr><tr><td class=docs>
<p>tenant:demo ; user: demo</p>
</td><td class=code><div class=highlight><pre>
            <span class="nb">source</span> <span class="nv">$TOP_DIR</span>/accrc/demo/demo
            euca-bundle-image -r <span class="k">${</span><span class="nv">CIRROS_ARCH</span><span class="k">}</span> -i <span class="s2">&quot;$kernel&quot;</span> --kernel <span class="nb">true</span> -d <span class="s2">&quot;$BOTO_MATERIALS_PATH&quot;</span>
            euca-bundle-image -r <span class="k">${</span><span class="nv">CIRROS_ARCH</span><span class="k">}</span> -i <span class="s2">&quot;$ramdisk&quot;</span> --ramdisk <span class="nb">true</span> -d <span class="s2">&quot;$BOTO_MATERIALS_PATH&quot;</span>
            euca-bundle-image -r <span class="k">${</span><span class="nv">CIRROS_ARCH</span><span class="k">}</span> -i <span class="s2">&quot;$disk_image&quot;</span> -d <span class="s2">&quot;$BOTO_MATERIALS_PATH&quot;</span>
        <span class="o">)</span> 2&gt;&amp;1 &lt;/dev/null | cat
    <span class="k">else</span>
<span class="k">        </span><span class="nb">echo</span> <span class="s2">&quot;Boto materials are not prepared&quot;</span>
    <span class="k">fi</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>Restore xtrace</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">$XTRACE</span>

</pre></div></td></tr><tr><td class=docs>
<p>Tell emacs to use shell-script-mode</p>
</td><td class=code><div class=highlight><pre>
<span class="c">## Local variables:</span>
<span class="c">## mode: shell-script</span>
<span class="c">## End:</span>


</td><td class=code><div class=highlight><pre>
</pre></div></td></tr><tr><td class=docs>
</pre></div></td></tr><tr><td class=docs>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
</div>
</div>
</body>
</html></td><td class='code'></td></tr>
    </tbody>
    </table>
</div>
</body>
</html>
